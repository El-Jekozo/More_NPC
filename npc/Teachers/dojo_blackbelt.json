[
  {
  	"//":"TODO write normal text not this bullshit parody of a writing, place him in dojo, prob 5-20%(?) maybe; how this shit works??'npc_class_change':'iron_palm_student';  ",
    "type": "npc",
    "id": "blackbelt_coach",
    "name_unique": "Black Belt",
    "gender": "male",
    "name_suffix": " Coach",
    "class": "blackbelt_coach",
    "attitude": 0,
    "mission": 7,
    "chat": "blackbelt_coach_1",
    "faction": "iron_palm",
	"mission_offered": "MISSION_blackbelt_coach_1"
  },
  {
    "type": "npc_class",
    "id": "blackbelt_coach",
    "name": { "str": "Black Belt Coach" },
    "job_description": "Black Belt Coach.",
    "common": false,
    "bonus_str": { "rng": [ 2, 4 ] },
    "bonus_dex": { "rng": [ 2, 4 ] },
    "bonus_int": { "rng": [ 1, 2 ] },
    "bonus_per": { "rng": [ 1, 2 ] },
    "worn_override": "blackbelt_coach_worn",
    "carry_override": "blackbelt_coach_carried",
    "wield_override": "blackbelt_coach_wield",
    "traits": [
	  { "group": "NPC_starting_traits" },
	  { "group": "Appearance_demographics" },
      { "trait": "PAINRESIST" }
    ],
    "skills": [
      { "skill": "melee", "level": 6 },
      { "skill": "unarmed", "level": 6 },
      { "skill": "dodge", "level": 6 }
    ],
	"initial_ma_styles": ["style_karate"]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_worn",
    "subtype": "collection",
    "entries": [
      { "item": "karate_gi" },
      { "item": "judo_belt_black" },
      { "item": "mouthpiece" },
      { "item": "geta" },
      { "item": "boxer_shorts" },
	  {"item": "shorts_denim"}
    ]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_carried",
    "subtype": "collection",
    "entries": [ 
	{ "item": "ip_leader_head" }
	]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_wield",
    "subtype": "collection"
  },
  {
    "type": "talk_topic",
    "id": [ "blackbelt_coach_1" ],
    "dynamic_line": {
  	"//":"TODO do or redo check helped or not",
      "u_has_var": "u_met_blackbelt_coach",
      "type": "general",
      "context": "meeting",
      "value": "yes",
      "yes": [ "Well, well.  I'm glad you are back.", "Hello again, my friend.", "It is good to see you again." ],
      "no": "Ah, another new face.  Hello.  I am Black Belt."
    },
    "responses": [
	  { 
		"text": "About that job...",
		"condition": "has_assigned_mission",
		"trial": { "type": "CONDITION",
			"condition": {
				"and":[
					{ "u_is_wearing": "karate_gi" },
					{ "u_is_wearing": "geta" },
					{"or": [
						{ "u_is_wearing": "judo_belt_white" },
						{ "u_is_wearing": "judo_belt_yellow" },
						{ "u_is_wearing": "judo_belt_green" },
						{ "u_is_wearing": "judo_belt_blue" },
						{ "u_is_wearing": "judo_belt_black" }
						]
					}
				]
			}	
		},
	    "success": {"topic": "TALK_MISSION_INQUIRE"},
	    "failure": {
			"topic": "blackbelt_coach_nope",
			"effect":[ {"npc_add_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes" } ]
		}
	  },
      { "text": "What's your story?", "topic": "blackbelt_coach_Background" },
      { "text": "Do you need any help?", 
	    "trial": { "type": "CONDITION",
		  "condition": {
			"and":[
				{ "u_is_wearing": "karate_gi" },
				{ "u_is_wearing": "geta" }
			]
		  }
	    },
	    "success": {"topic": "TALK_MISSION_LIST"},
	    "failure": {
			"topic": "blackbelt_coach_nope",
			"effect":[ {"npc_add_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes" } ]
		}
	  },
      { "text": "Can you teach me something?", "topic": "blackbelt_coach_teach_check"},
      { "text": "How can I become your student?", "topic": "blackbelt_coach_student",
		"condition": {"npc_has_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes"}
	  },
      { "text": "What about help?", "topic": "bbm_flame_knuckle_1",
	    "condition":{"npc_has_var":"bbm_flame_knuckle", "type": "general", "context": "flag", "value": "yes"},
	    "effect":[
			{"npc_change_faction": "flame_knuckle"},
			{ "u_faction_rep": 100 }
		]
	  },
      { "text": "Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_Background",
    "dynamic_line": "Before the cataclysm, there were two major fighting schools in our state: Steel Palm and Flame Fist. The Steel Palm quickly fell apart, as all the students and masters turned into zombies, but Flame Fist somehow kept his school, and even attract new members, promising them protection from the outside world. Everything would be fine, but the leader of Flame Fist decided to end the School of Steel Palm once and for all. I, as the last master of my school, must prevent this!",
    "responses": [
      { "text": "Interesting", "topic": "TALK_NONE" },
      { "text": "I think your lying!!!", 
	    "condition": {"not":{"npc_has_var": "blackbelt_coach_background", "type": "general", "context": "meeting", "value": "yes"}},
	    "trial": { "type": "PERSUADE", "difficulty": 8 },
		"success": { "topic": "blackbelt_coach_truth" },
		"failure": { "topic": "blackbelt_coach_truth" } 
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach_check",
    "dynamic_line": "I teach only those who help my school. Did you helped my school?",
    "responses": [
      { "text": "Yeah, bruh, i'm cool", "topic": "blackbelt_coach_teach",
	    "condition": {"npc_has_var": "u_helped_blackbelt_coach", "type": "general", "context": "meeting", "value": "yes"},
		"trial": { "type": "CONDITION", "condition": {"npc_has_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "yes"}},
		"success": {
			"effect":[
				{"u_buy_item": "manual_karate"},
				{"npc_add_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "no"}
			],
			"topic": "blackbelt_coach_teach" 
		},
		"failure": { "topic": "blackbelt_coach_teach_done" }
	  },
      { "text": "Sorry I'm noob", "topic": "TALK_NONE"
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach",
    "dynamic_line": "I learned all from this book. You can take it now. Good luck, student!",
    "responses": [
      { "text": "Thanks, master!", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach_done",
    "dynamic_line": "I already taught you all I knew.",
    "responses": [
      { "text": "Thanks again, teacher.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_truth",
    "dynamic_line": "What?! Masters don't lie! You want to feel my iron fury? You want to feel REAL PAIN?!",
    "responses": [
      { "text": "I'm sorry, master! Please don't kill me!", "topic": "blackbelt_coach_1",
		"effect":[{"npc_add_var": "blackbelt_coach_background", "type": "general", "context": "meeting", "value": "yes"}]
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_nope",
    "dynamic_line": "I'm only talking to my students about my problems!",
    "responses": [
      { "text": "I'm sorry, master!", "topic": "TALK_NONE"}
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_student",
    "dynamic_line": "First, you need to find proper uniform. You should wear Karate Gi and Geta to start your training. By the way, this is strictly not allowed, but in this dire sircumstances, you can 'borrow' uniform from any not-any-more student.",
    "responses": [
      { "text": "I understand. I'll return when I get the uniform!", "topic": "TALK_NONE",
		"effect":[ {"npc_lose_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes" } ] 
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "bbm_flame_knuckle_1",
    "dynamic_line": "Take this and good luck.",
    "responses": [
      { "text": "Thank you, master", "topic": "TALK_DONE", "effect":[{"npc_change_faction":"no_faction"}, {"u_buy_item":"flyer_fk"}]}
    ]
  },
  {
    "type": "talk_topic",
    "id": "bbm_wu",
    "dynamic_line": {"u_has_var":"fkl_business", "type": "flag", "context": "meeting", "value": "yes",
		"yes":"Go away, traitor!",
		"no":"..."},
    "responses": [
      { "text": "I'm back!", "topic": "blackbelt_coach_1", 
		"condition":{ "not":{ "u_has_var":"fkl_business", "type": "flag", "context": "meeting", "value": "yes" } }
	  },
      { "text": "...", "topic": "TALK_DONE",
	    "condition":{"u_has_var":"fkl_business", "type": "flag", "context": "meeting", "value": "yes"},
		"effect":["mission_failure", "end_conversation"],
		"switch":true
	  },
      { "text": "...", "topic": "TALK_DONE", "switch":true}
    ]
  },
  {
    "id": "MISSION_blackbelt_coach_1",
	"//":"TODO add custom fail + text",
    "type": "mission_definition",
    "name": { "str": "Find informer" },
    "description": "Find the informer, who will help master in his task to destroy 'Flaming Knuckle' school.",
    "goal": "MGOAL_CONDITION",
	"goal_condition": { "u_has_var": "blackbelt_coach_m1", "type": "general", "context": "meeting", "value": "yes" },
    "difficulty": 0,
    "value": 1000,
	"start":{
		"effect":[
			{"u_buy_item":"judo_belt_white"}
		],
      "assign_mission_target": { "om_terrain": "forest", "om_terrain_replace": "field","om_terrain_match_type":"PREFIX", "reveal_radius": 1, "search_range": 40, "min_distance": 3 },
      "update_mapgen": {"place_npcs": [{ "class": "flame_knuckle_apprentice_informer", "x": 5, "y": 5 }]
	  }
	},
	"end":{
		"effect":[
			{"u_consume_item":"judo_belt_white"},
			{"u_buy_item":"judo_belt_yellow"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_2",
    "dialogue": {
      "describe": "True student!!!",
      "offer": "Well well, you decided to help me in my difficult task? Okay, listen here, student. I managed to recruit one survivor and persuade him to join Flamefist and leak information to me. The time has come for the next collection of information. Meet him in the nearby forest, get everything he knows from him and come back here. Oh yes, password: 'Berries'",
      "accepted": "I didn’t doubt you. Hold this belt as a symbol of your entry into Steel Palm School! Go, and don't come to me until you complete your task!",
      "rejected": "Are you scared?",
      "advice": "Be careful. The guy could be figured out, so try not to bring the tail here.",
      "inquire": "I'm waiting.",
      "success": "Well done, student. I knew you would succeed! Well, tell me ... Hmmm, that's how it is. Well, it complicates my job a little. I need a little time to think things over. Here, hold this belt, you deserve it. Rest now.",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
		},
    "fail": { 
		"condition":{"u_has_var": "blackbelt_coach_m1", "type": "general", "context": "meeting", "value": "no"},
		"effect":[
			{"u_consume_item":"judo_belt_yellow"},
			{ "u_consume_item": "karate_gi" },
			{ "u_consume_item": "geta" }
		]
	}
	},
  {
    "id": "MISSION_blackbelt_coach_2",
    "type": "mission_definition",
    "name": { "str": "Kill one of the trainers" },
    "description": "The Master has asked you to kill one of the Flame Fist School trainers before he can train a new group of students.",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 100,
    "deadline_low": 14,
    "deadline_high": 28,
    "start": {
	  "effect":[{"npc_first_topic":"bbm_wu"}],
      "assign_mission_target": {
		"om_terrain": "dojo_1",
		"om_terrain_replace": "house",
		"om_terrain_match_type":"PREFIX",
		"cant_see": true,
		"reveal_radius": 1,
		"search_range": 200,
		"min_distance": 5 
	  },
      "update_mapgen": {
        "place_npcs": [
          { "class": "flame_knuckle_apprentice", "x": 10, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 11, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 12, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 13, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 14, "y": 13 },
          { "class": "flame_knuckle_elite_coach", "x": 12, "y": 12, "target": true }
        ]
	  }
    },
	"end":{
		"effect":[
			{"u_consume_item":"judo_belt_yellow"},
			{"u_buy_item":"judo_belt_green"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_3",
    "dialogue": {
      "describe": "True student!!!",
      "offer": "Thanks to the information you gave me, I learned that Flamefist is planning to train a new group of fresh apprentices, and I want to prevent this. Find this asshole, use your steel palm and make him choke on blood! .. What? What about the students? Don't give a damn, do what you want. Oh yeah, the workout will take about 2-4 weeks, so hurry up! They won't sit there forever.",
      "accepted": "Well done, I like your attitude. Show them the true path of the Steel Palm!",
      "rejected": "Afraid?!",
      "advice": "Don't forget to tell him a few sweet words from me!",
      "inquire": "I'm waiting.",
      "success": "Nice! ",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
	},
    "fail": {
	  "effect":[
		{"u_consume_item":"judo_belt_yellow"},
		{ "u_consume_item": "karate_gi" },
		{ "u_consume_item": "geta" }
	  ]
	}
  },
  {
    "id": "MISSION_blackbelt_coach_3",
    "type": "mission_definition",
    "name": { "str": "It's time to end the Flame Knuckle" },
    "description": "End Flame Knuckle!",
    "goal": "MGOAL_FIND_ITEM",
    "item": "ip_leader_head",
    "difficulty": 0,
    "value": 100,
  	"//":"TODO map large hq for FlameKnuckles",
    "start": {
	  "effect":[
		{"npc_add_var": "bbm_flame_knuckle", "type": "general", "context": "flag", "value": "yes"}
	  ],
	"assign_mission_target": {
		"om_terrain": "dojo_1",
		"om_terrain_replace": "house",
		"om_terrain_match_type":"PREFIX",
		"cant_see": true,
		"reveal_radius": 1,
		"random": true,
		"search_range": 200,
		"min_distance": 5
	},
    "mapgen_update": "dojo_1",
	"origin_npc": true
    },
	"end":{
		"effect":[
			{"u_consume_item":"judo_belt_green"},
			{"u_buy_item":"judo_belt_blue"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_4",
    "dialogue": {
      "describe": "True Faith!!",
      "offer": "Kill them.",
      "accepted": "Good. If you want to do it quietly, ask me how.",
      "rejected": "Hmm.",
      "advice": "Yes",
      "inquire": "So?",
      "success": "Good. Take this belt.",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
	},
	"fail": { "effect":[
		{"u_consume_item":"judo_belt_green"},
		{ "u_consume_item": "karate_gi" },
		{ "u_consume_item": "geta" }
		]
	}
  },
  {
    "id": "MISSION_blackbelt_coach_4",
    "type": "mission_definition",
    "name": { "str": "Find me new students" },
    "description": "Find new students.",
    "goal": "MGOAL_CONDITION",
	"goal_condition": {"u_has_var":"bbm_students", "type": "flag", "context": "meeting", "value": "2"},
    "difficulty": 0,
    "value": 1000,
	"start":{
		"effect":[
			{"u_add_var":"bbm_students", "type": "flag", "context": "meeting", "value": "0"},
			{"u_add_var":"students_transfer", "type": "flag", "context": "meeting", "value": "ip"}
		]
	},
	"end":{
		"effect":[
			{"u_consume_item":"judo_belt_blue"},
			{"u_buy_item":"judo_belt_black"},
			{"npc_add_var": "u_helped_blackbelt_coach", "type": "general", "context": "meeting", "value": "yes"},
			{"npc_add_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "yes"},
			{"u_lose_var":"bbm_students", "type": "flag", "context": "meeting", "value": "2"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "dialogue": {
      "describe": "True student!!!",
      "offer": "Bring me students.",
      "accepted": "I'm waiting.",
      "rejected": "Afraid?",
      "advice": "Go.",
      "inquire": "I'm waiting.",
      "success": "Good. Here's your reward.",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
	}
  }
]