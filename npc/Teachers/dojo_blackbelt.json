[
  {
  	"//":"TODO write normal text not this bullshit parody of a writing, place him in dojo, prob 5-20%(?) maybe; how this shit works??'npc_class_change':'iron_palm_student'; idea for mission 4: go to large building with followers of flame knuckles, talk to leader, leader attack you with his squad. kill all and return. do not forget to make unique leader; redo check for training by 'sentinel' effect in 'speaker_effect' ",
    "type": "npc",
    "id": "blackbelt_coach",
    "name_unique": "Black Belt",
    "gender": "male",
    "name_suffix": " Coach",
    "class": "blackbelt_coach",
    "attitude": 0,
    "mission": 7,
    "chat": "blackbelt_coach_1",
    "faction": "iron_palm",
	"mission_offered": "MISSION_blackbelt_coach_1"
  },
  {
    "type": "npc_class",
    "id": "blackbelt_coach",
    "name": { "str": "Black Belt Coach" },
    "job_description": "Black Belt Coach.",
    "common": false,
    "bonus_str": { "rng": [ 2, 4 ] },
    "bonus_dex": { "rng": [ 2, 4 ] },
    "bonus_int": { "rng": [ 1, 2 ] },
    "bonus_per": { "rng": [ 1, 2 ] },
    "worn_override": "blackbelt_coach_worn",
    "carry_override": "blackbelt_coach_carried",
    "wield_override": "blackbelt_coach_wield",
    "traits": [
      { "trait": "PAINRESIST" },
	  { "trait": "PROF_MA_BLACK"}
    ],
    "skills": [
      { "skill": "melee", "level": 6 },
      { "skill": "unarmed", "level": 6 },
      { "skill": "dodge", "level": 6 }
    ]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_worn",
    "subtype": "collection",
    "entries": [
      { "item": "karate_gi" },
      { "item": "judo_belt_black" },
      { "item": "mouthpiece" },
      { "item": "geta" },
      { "item": "boxer_shorts" },
	  {"item": "shorts_denim"}
    ]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_carried",
    "subtype": "collection",
    "entries": [ 
	{ "item": "ip_leader_head" }
	]
  },
  {
    "type": "item_group",
    "id": "blackbelt_coach_wield",
    "subtype": "collection"
  },
  {
    "type": "talk_topic",
    "id": [ "blackbelt_coach_1" ],
    "dynamic_line": {
  	"//":"TODO do or redo check helped or not",
      "u_has_var": "u_met_blackbelt_coach",
      "type": "general",
      "context": "meeting",
      "value": "yes",
      "yes": [ "Well, well.  I'm glad you are back.", "Hello again, my friend.", "It is good to see you again." ],
      "no": "Ah, another new face.  Hello.  I am Black Belt."
    },
    "responses": [
	  { 
	  "text": "About that job...",
      "condition": "has_assigned_mission",
	  "trial": { "type": "CONDITION", "condition": {
	    "and":[
		  { "u_is_wearing": "karate_gi" },
		  { "u_is_wearing": "geta" },
		  {"or": [
			{ "u_is_wearing": "judo_belt_white" },
			{ "u_is_wearing": "judo_belt_yellow" },
			{ "u_is_wearing": "judo_belt_green" },
			{ "u_is_wearing": "judo_belt_blue" },
			{ "u_is_wearing": "judo_belt_black" }
			]
		  }
	    ]
	  }
	  },
	  "success": {"topic": "TALK_MISSION_INQUIRE"},
	  "failure": {"topic": "blackbelt_coach_nope"}
	  },
      { "text": "What's your story?", "topic": "blackbelt_coach_Background" },
      { "text": "Do you need any help?", 
	  "trial": { "type": "CONDITION", "condition": {
	    "and":[
		  { "u_is_wearing": "karate_gi" },
		  { "u_is_wearing": "geta" }
	    ]
	  }
	  },
	  "success": {"topic": "TALK_MISSION_LIST"},
	  "failure": {"topic": "blackbelt_coach_nope", "effect":[{"npc_add_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes"}]}
	  },
      { "text": "Can you teach me something?", "topic": "blackbelt_coach_teach_check"},
      { "text": "How can I become your student?", "topic": "blackbelt_coach_student", "condition": {"npc_has_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes"}},
      { "text": "What about help?", "topic": "bbm_flame_knuckle_1", "condition":{"npc_has_var":"bbm_flame_knuckle", "type": "general", "context": "flag", "value": "yes"}, "effect":[{"npc_change_faction": "flame_knuckle"}, { "u_faction_rep": 100 }]},
      { "text": "Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_Background",
    "dynamic_line": "!!!До катаклизма, в нашем штате было две крупные бойцовские школы: Стальная Ладонь и Пламенный Кулак. Стальная Ладонь быстро развалилась, так как все ученики и мастера превратились в зомби, но вот Пламенному Кулаку как-то удалось сохранить свою школу, да ещё и привлечь новых членов, обещая им защиту от внешнего мира. Всё бы ничего, но лидер Пламенного Кулака решил покончить со школой Стальной Ладони раз и навсегда. Я, как последний мастер моей школы, обязан это предотвратить!",
    "responses": [
      { "text": "Interesting", "topic": "TALK_NONE" },
      { "text": "I think your lying!!!", 
	    "condition": {"not":{"npc_has_var": "blackbelt_coach_background", "type": "general", "context": "meeting", "value": "yes"}},
	    "trial": { "type": "PERSUADE", "difficulty": 8 },
		"success": { "topic": "blackbelt_coach_truth" },
		"failure": { "topic": "blackbelt_coach_truth" } 
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach_check",
    "dynamic_line": "I teach only those who help my school. Did you helped my school?",
    "responses": [
      { "text": "Yeah, bruh, i'm cool", "topic": "blackbelt_coach_teach",
	    "condition": {"npc_has_var": "u_helped_blackbelt_coach", "type": "general", "context": "meeting", "value": "yes"},
		"trial": { "type": "CONDITION", "condition": {"npc_has_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "yes"}},
		"success": {
			"effect":[
			{"u_buy_item": "manual_karate"},
			{"npc_add_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "no"}
			],
			"topic": "blackbelt_coach_teach" 
		},
		"failure": { "topic": "blackbelt_coach_teach_done" }
	  },
      { "text": "Sorry I'm muslim", "topic": "TALK_NONE"
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach",
    "dynamic_line": "I learned all from this book. You can take it now. Good luck, student!",
    "responses": [
      { "text": "Thanks, master!", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_teach_done",
    "dynamic_line": "I already taught you all I knew.",
    "responses": [
      { "text": "Thanks again, teacher.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_truth",
    "dynamic_line": "What?! Masters don't lie! You want to feel my iron fury? You want to feel REAL PAIN?!",
    "responses": [
      { "text": "I'm sorry, master! Please don't kill me!", "topic": "blackbelt_coach_1",
		"effect":[{"npc_add_var": "blackbelt_coach_background", "type": "general", "context": "meeting", "value": "yes"}]}
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_nope",
    "dynamic_line": "I'm only talking to my students about my problems. Dress yourself properly and return to me.",
    "responses": [
      { "text": "I'm sorry, master! Will do, master!", "topic": "TALK_DONE"}
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_student",
    "dynamic_line": "First, you need to find proper uniform. You should wear Karate Gi and Geta to start your training. By the way, this is strictly not allowed, but in this dire sircumstances, you can 'borrow' uniform from any not-any-more student.",
    "responses": [
      { "text": "I understand. I'll return when I get the uniform!", "topic": "TALK_NONE", "effect":[{"npc_lose_var":"blackbelt_coach_student", "type": "flag", "context": "meeting", "value": "yes"}]}
    ]
  },
  {
    "type": "talk_topic",
    "id": "bbm_flame_knuckle_1",
    "dynamic_line": "Take this and good luck.",
    "responses": [
      { "text": "Thank you, master", "topic": "TALK_DONE", "effect":[{"npc_change_faction":"no_faction"}, {"u_buy_item":"flyer_fk"}]}
    ]
  },
  {
    "type": "talk_topic",
    "id": "bbm_wu",
    "dynamic_line": [{"u_has_var":"fkl_business", "type": "flag", "context": "meeting", "value": "yes",
		"yes":"Go away, traitor!",
		"no":"..."}],
    "responses": [
      { "text": "I'm back!", "topic": "MISSION_blackbelt_coach_1", "condition":{"not":{"u_has_var":"fkl_business", "type": "flag", "context": "meeting", "value": "yes"}}},
      { "text": "...", "topic": "TALK_DONE"}
    ]
  },
  {
    "id": "MISSION_blackbelt_coach_1",
	"//":"TODO add custom fail + text",
    "type": "mission_definition",
    "name": { "str": "Find informer" },
    "description": "Find the informer, who will help master in his task to destroy 'Flaming Knuckle' school.",
    "goal": "MGOAL_CONDITION",
	"goal_condition": { "u_has_var": "blackbelt_coach_m1", "type": "general", "context": "meeting", "value": "yes" },
    "difficulty": 0,
    "value": 1000,
	"start":{
		"effect":[
		{"u_buy_item":"judo_belt_white"}
		],
      "assign_mission_target": { "om_terrain": "forest", "om_terrain_replace": "field","om_terrain_match_type":"PREFIX", "reveal_radius": 1, "search_range": 40, "min_distance": 3 },
      "update_mapgen": {"place_npcs": [{ "class": "flame_knuckle_apprentice_informer", "x": 5, "y": 5 }]
	  }
	},
	"end":{
		"effect":[
		{"u_consume_item":"judo_belt_white"},
		{"u_buy_item":"judo_belt_yellow"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_2",
    "dialogue": {
      "describe": "True student!!!",
      "offer": "!!!Ну чтоб ты решил помочь мне в моём нелёгком деле? Хорошо, слушай сюда, ученик. Мне удалось завербовать одного выжившего и уговорить его вступить в Пламенный Кулак и сливать мне информацию. Пришла пора очередного сбора информации. Встреться с ним в ближайшем лесу, выпытай у него всё, что он знает и возвращайся сюда. Ах да, пароль: 'Ягодки'",
      "accepted": "!!!Я в тебе не сомневался. Держи этот пояс, как символ твоего вступления в школу Стальной Ладони! Ступай, и не приходи ко мне пока не выполнишь своё задание!",
      "rejected": "!!!Ты что, испугался?",
      "advice": "!!!Будь аккуратен. Аарня могли вычислить, так что постарайся не привести сюда хвост.",
      "inquire": "I'm waiting.",
      "success": "!!!Молодец, ученик. Я знал, что у тебя всё получится! Ну что, рассказывай... Хммм, вот оно как. Ну что же, это немного осложняет мою работу. Мне нужно немного времени, чтобы обдумать всё. Вот, держи этот пояс, ты заслужил. Теперь отдыхай.",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
		},
    "fail": { 
		"condition":{"u_has_var": "blackbelt_coach_m1", "type": "general", "context": "meeting", "value": "no"},
		"effect":[
			{"u_consume_item":"judo_belt_yellow"},
			{ "u_consume_item": "karate_gi" },
			{ "u_consume_item": "geta" }
		]
	}
	},
  {
    "id": "MISSION_blackbelt_coach_2",
    "type": "mission_definition",
    "name": { "str": "!!!Убей одного из тренеров" },
    "description": "!!!Мастер попросил тебя убить одного из тренеров школы Пламенного Кулака до того, как он сможет обучить новую группу учеников.",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 100,
    "deadline_low": 14,
    "deadline_high": 28,
    "start": {
		"effect":[{"npc_first_topic":"bbm_wu"}],
      "assign_mission_target": { "om_terrain": "dojo_1", "om_terrain_replace": "house", "om_terrain_match_type":"PREFIX", "cant_see": true, "reveal_radius": 1, "search_range": 200, "min_distance": 5 },
      "update_mapgen": {
        "place_npcs": [
          { "class": "flame_knuckle_apprentice", "x": 10, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 11, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 12, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 13, "y": 13 },
          { "class": "flame_knuckle_apprentice", "x": 14, "y": 13 },
          { "class": "flame_knuckle_elite_coach", "x": 12, "y": 12, "target": true }
        ]
	  }
    },
	"end":{
		"effect":[
		{"u_consume_item":"judo_belt_yellow"},
		{"u_buy_item":"judo_belt_green"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_3",
    "dialogue": {
      "describe": "True student!!!",
      "offer": "!!!Благодаря той информации что ты мне дал, я узнал, что Пламенный Кулак планирует обучить новую группу свежих учеников, и я хочу предотвратить это. Найди этого засранца, воспользуйся своей стальной ладонью и заставь его подавиться кровью!.. Что? Что с учениками? Плевать, делай что хочешь. Ах да, тренирова будет идти примерно 2-4 недели, так что поспеши! Они не будут сидеть там вечность.",
      "accepted": "!!!Молодец, мне нравится твой настрой. Покажи им настоящий путь Стальной Ладони!",
      "rejected": "!!!Испугался?!",
      "advice": "!!!Не забудь сказать ему пару ласковых слов от меня!",
      "inquire": "I'm waiting.",
      "success": "!!!Молодец, просто молодец, я бы сам не сделал лучше! ",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
	},
    "fail": { "effect":[
		{"u_consume_item":"judo_belt_yellow"},
		{ "u_consume_item": "karate_gi" },
		{ "u_consume_item": "geta" }
		]
	}
	},
  {
    "id": "MISSION_blackbelt_coach_3",
    "type": "mission_definition",
    "name": { "str": "It's time to end the Flame Knuckle" },
    "description": "!!!Мастер попросил тебя покончить с Пламенным Кулаком раз и навсегда",
    "goal": "MGOAL_FIND_ITEM",
    "item": "ip_leader_head",
    "difficulty": 0,
    "value": 100,
  	"//":"TODO map large hq for FlameKnuckles",
    "start": {
	  "effect":[{"npc_add_var": "bbm_flame_knuckle", "type": "general", "context": "flag", "value": "yes"}],
    "mapgen_update": "flame_knuckles_base", "origin_npc": true, "assign_mission_target": { "om_terrain": "dojo_1", "om_terrain_replace": "house", "om_terrain_match_type":"PREFIX", "cant_see": true, "reveal_radius": 1, "random": true, "search_range": 200, "min_distance": 5 }
    },
	"end":{
		"effect":[
			{"u_consume_item":"judo_belt_green"},
			{"u_buy_item":"judo_belt_blue"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_blackbelt_coach_4",
    "dialogue": {
      "describe": "True Faith!!",
      "offer": "!!!Завали их нахуй.",
      "accepted": "!!!Красава. Если хочешь всё сделать аккуратно - поговори со мной, обсудим.",
      "rejected": "!!!Ну ты выдал",
      "advice": "!!!Левый коронный правый похоронный",
      "inquire": "!!!Ну чё там",
      "success": "!!!Уважаю. Держи пояс",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
	},
	"fail": { "effect":[
		{"u_consume_item":"judo_belt_green"},
		{ "u_consume_item": "karate_gi" },
		{ "u_consume_item": "geta" }
		]
	}
  },
  {
    "id": "MISSION_blackbelt_coach_4",
    "type": "mission_definition",
    "name": { "str": "Find me new students" },
    "description": "Find new students.",
    "goal": "MGOAL_CONDITION",
	"goal_condition": {"u_has_var":"bbm_students", "type": "flag", "context": "meeting", "value": "2"},
    "difficulty": 0,
    "value": 1000,
	"start":{
		"effect":[
			{"u_add_var":"bbm_students", "type": "flag", "context": "meeting", "value": "0"},
			{"u_add_var":"students_ip_fk", "type": "flag", "context": "meeting", "value": "ip"}
		]
	},
	"end":{
		"effect":[
		{"u_consume_item":"judo_belt_blue"},
		{"u_buy_item":"judo_belt_black"},
		{"npc_add_var": "u_helped_blackbelt_coach", "type": "general", "context": "meeting", "value": "yes"},
		{"npc_add_var": "blackbelt_coach_teach", "type": "general", "context": "meeting", "value": "yes"},
		{"u_lose_var":"bbm_students", "type": "flag", "context": "meeting", "value": "2"}
		]
	},
    "origins": [ "ORIGIN_SECONDARY" ],
    "dialogue": {
      "describe": "True student!!!",
      "offer": "!!!Учеников мне нарисуй",
      "accepted": "!!!Жду",
      "rejected": "!!!Ты что, испугался?",
      "advice": "!!!Будь аккуратен.",
      "inquire": "I'm waiting.",
      "success": "!!!Молодец, держи пояс.",
      "success_lie": "True warriors don't lie!",
      "failure": "You are a disgrace to your family!"
		}
	}
]