[
  {
    "//": "TODO potom",
    "type": "npc",
    "id": "lighthouse_man",
    "gender": "male",
    "class": "NC_SCAVENGER",
    "name_suffix": "Fisherman",
    "attitude": 0,
    "mission": 7,
    "chat": "lighthouse_man_1",
    "faction": "no_faction",
    "mission_offered": "MISSION_lighthouse_man_1"
  },
  {
    "type": "talk_topic",
    "id": [ "lighthouse_man_1" ],
    "dynamic_line": "<greet>",
    "responses": [
      { "text": "About that job…", "condition": "has_assigned_mission", "topic": "TALK_MISSION_INQUIRE" },
      { "text": "<BGSS_intro_question>", "topic": "lighthouse_man_Background" },
      { "text": "Do you need any help?", "topic": "TALK_MISSION_LIST" },
      { "text": "Can you teach me something?", "topic": "lighthouse_man_teach_check" },
      { "text": "Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_Background",
    "dynamic_line": "I'm just a regular survivor. I have a nice family, wife and daughter. That's all.",
    "responses": [ { "text": "<done_conversation_section>", "topic": "TALK_NONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_teach_check",
    "dynamic_line": "Maybe later.",
    "responses": [
      {
        "text": "What about now?",
        "condition": { "npc_has_var": "u_helped_lighthouse_man", "type": "general", "context": "meeting", "value": "yes" },
        "trial": {
          "type": "CONDITION",
          "condition": { "npc_has_var": "lighthouse_man_teach", "type": "general", "context": "meeting", "value": "yes" }
        },
        "success": {
          "effect": [
            { "u_add_trait": "OUTDOORSMAN" },
            { "npc_lose_var": "lighthouse_man_teach", "type": "general", "context": "meeting", "value": "no" }
          ],
          "topic": "lighthouse_man_teach"
        },
        "failure": { "topic": "lighthouse_man_teach_done" }
      },
      { "text": "…", "topic": "TALK_NONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_teach",
    "dynamic_line": "well, if you insist.",
    "responses": [ { "text": "Thanks!", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_teach_done",
    "dynamic_line": "I already taught you all I knew.",
    "responses": [ { "text": "Thanks again!", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_lighthouse",
    "dynamic_line": "Are we there yet?",
    "responses": [
      {
        "text": "We're here.",
        "topic": "lighthouse_man_1",
        "condition": { "npc_at_om_location": "lighthouse_ground" },
        "effect": [ "stop_following", { "npc_first_topic": "lighthouse_man_1" } ]
      },
      { "text": "Follow me.", "topic": "TALK_DONE", "effect": "follow_only" },
      { "text": "Wait for me here.", "topic": "TALK_DONE", "effect": "stop_following" },
      { "text": "Almost.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_cleaning",
    "dynamic_line": "Is it safe, my <name_g>?",
    "responses": [
      {
        "text": "Yes. Ground floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "0" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_ground" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. First floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "1" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z1" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. Second floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "2" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z2" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. Third floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "3" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z2" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. Fourth floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "4" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z3" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. Fifth floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "5" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z4" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "Yes. Top floor.",
        "topic": "lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "6" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z5" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "adjustment": 1 }
      },
      {
        "text": "All done.",
        "topic": "lighthouse_man_1",
        "condition": { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "7" }
      },
      { "text": "Not yet.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_cleaned",
    "dynamic_line": "<its_safe> Let's clean the next floor.",
    "responses": [ { "text": "…", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_wait",
    "dynamic_line": "…",
    "responses": [
      { "text": "Hi", "topic": "lighthouse_man_1" },
      { "text": "I want to show you your boat. Go with me.", "topic": "TALK_DONE", "effect": "follow_only" },
      { "text": "Stay here", "topic": "TALK_DONE", "effect": "stop_following" },
      {
        "text": "Here's your boat, bro",
        "topic": "TALK_MISSION_SUCCESS",
        "condition": "u_is_driving",
        "effect": "mission_success"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "lighthouse_man_family",
    "dynamic_line": "So?",
    "responses": [
      {
        "text": "We did it! All safe!",
        "topic": "TALK_MISSION_SUCCESS",
        "condition": {
          "and": [
            { "not": "mission_complete" },
            { "u_has_var": "lighthouse_woman_safe", "type": "general", "context": "meeting", "value": "yes" },
            { "u_has_var": "lighthouse_girl_safe", "type": "general", "context": "meeting", "value": "yes" }
          ]
        },
        "effect": [ "mission_success", { "npc_first_topic": "lighthouse_man_1" } ]
      },
      {
        "text": "I failed, all dead!",
        "topic": "TALK_MISSION_FAILURE",
        "condition": {
          "and": [
            "mission_complete",
            {
              "not": { "u_has_var": "lighthouse_woman_safe", "type": "general", "context": "meeting", "value": "yes" }
            },
            {
              "not": { "u_has_var": "lighthouse_girl_safe", "type": "general", "context": "meeting", "value": "yes" }
            }
          ]
        },
        "effect": { "npc_first_topic": "lighthouse_man_1" }
      },
      {
        "text": "Wife dead, daughter alive!",
        "topic": "TALK_MISSION_FAILURE",
        "condition": {
          "and": [ "mission_complete", { "u_has_var": "lighthouse_girl_safe", "type": "general", "context": "meeting", "value": "yes" } ]
        },
        "effect": { "npc_first_topic": "lighthouse_man_1" }
      },
      {
        "text": "Wife alive, daughter dead",
        "topic": "TALK_MISSION_FAILURE",
        "condition": {
          "and": [
            { "not": "mission_complete" },
            { "u_has_var": "lighthouse_woman_safe", "type": "general", "context": "meeting", "value": "yes" }
          ]
        },
        "effect": { "npc_first_topic": "lighthouse_man_1" }
      },
      { "text": "Nothing, really.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "MISSION_lighthouse_man_1",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": { "str": "Help me find lighthouse" },
    "description": "Help him find lighthouse",
    "goal": "MGOAL_GO_TO_TYPE",
    "destination": "lighthouse_ground",
    "difficulty": 0,
    "value": 1000,
    "start": { "effect": "follow_only" },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_2",
    "dialogue": {
      "describe": "-",
      "offer": "Help me find lighthouse, so I can live there with my family.",
      "accepted": "Good. I'll come with you.",
      "rejected": "~",
      "advice": "~",
      "inquire": "So?",
      "success": "Klass.",
      "success_lie": "Um…",
      "failure": "What a shame."
    }
  },
  {
    "id": "MISSION_lighthouse_man_2",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": { "str": "Help me clean lighthouse" },
    "description": "Help me clean lighthouse",
    "goal": "MGOAL_CONDITION",
    "goal_condition": { "npc_has_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "7" },
    "difficulty": 0,
    "value": 100,
    "start": {
      "effect": [
        "follow_only",
        { "npc_add_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "0" },
        { "npc_first_topic": "lighthouse_man_cleaning" }
      ]
    },
    "end": {
      "effect": [
        "stop_following",
        { "npc_lose_var": "lighthouse_man_cleaning", "type": "general", "context": "meeting", "value": "7" },
        { "npc_first_topic": "lighthouse_man_1" }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_3",
    "dialogue": {
      "describe": "-",
      "offer": "Help me clean lighthouse from zeds. I'll help you. Talk to me when you think the floor is cleaned.",
      "accepted": "~",
      "rejected": "~",
      "advice": "~",
      "inquire": "~",
      "success": "Yes!!!",
      "success_lie": "~",
      "failure": "~"
    }
  },
  {
    "id": "MISSION_lighthouse_man_3",
    "type": "mission_definition",
    "name": { "str": "Help fisherman's family" },
    "description": "Fisherman asked you to bring him his family.",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 100,
    "start": {
      "effect": { "npc_first_topic": "lighthouse_man_family" },
      "assign_mission_target": {
        "om_terrain": "house_04_basement",
        "om_terrain_replace": "house",
        "om_terrain_match_type": "PREFIX",
        "reveal_radius": 2,
        "search_range": 250,
        "min_distance": 50
      },
      "update_mapgen": {
        "place_npcs": [ { "class": "lighthouse_woman", "x": 4, "y": 8, "target": true }, { "class": "lighthouse_girl", "x": 3, "y": 7 } ]
      }
    },
    "fail": { "effect": "end_conversation" },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_4",
    "dialogue": {
      "describe": "-",
      "offer": "We cleaned this lighthouse, so now I can live here with my family. Bring my family back to me please.",
      "accepted": "~",
      "rejected": "~",
      "advice": "~",
      "inquire": "So?",
      "success": "Yes!!!",
      "success_lie": "~",
      "failure": "~"
    }
  },
  {
    "id": "MISSION_lighthouse_man_4",
    "type": "mission_definition",
    "name": { "str": "Help me make a boat" },
    "description": "Help me make a boat, or find me one",
    "goal": "MGOAL_FIND_ITEM",
    "item": "2x4",
    "count": 50,
    "difficulty": 0,
    "value": 100,
    "//": "redo quest",
    "start": {
      "effect": [
        { "npc_first_topic": "lighthouse_man_wait" },
        { "npc_add_var": "u_helped_lighthouse_man", "type": "general", "context": "meeting", "value": "yes" },
        { "npc_add_var": "lighthouse_man_teach", "type": "general", "context": "meeting", "value": "yes" }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_5",
    "dialogue": {
      "describe": "-",
      "offer": "I need a boat to fish or to loot coastline. Help me make a boat. Bring 50 2x4. Or find me boat.",
      "accepted": "~",
      "rejected": "~",
      "advice": "~",
      "inquire": "So?",
      "success": "Yes!!! I can teach you something if you want.",
      "success_lie": "~",
      "failure": "~"
    }
  },
  {
    "id": "MISSION_lighthouse_man_5",
    "type": "mission_definition",
    "name": { "str": "Help me fix lighthouse" },
    "description": "Help me fix lighthouse",
    "goal": "MGOAL_FIND_ITEM",
    "item": "rock",
    "count": 1,
    "difficulty": 0,
    "value": 100,
    "//": "redo quest",
    "end": { "update_mapgen": { "place_item": [ { "item": "rock", "x": 15, "y": 11 } ] } },
    "origins": [ "ORIGIN_SECONDARY" ],
    "dialogue": {
      "describe": "-",
      "offer": "So, my family is here, I have a boat to fish. We'll be fine here. I want to help other survivors. Help me fix lighthouse so other survivors would see it from afat. Bring electronic parts.",
      "accepted": "Good.",
      "rejected": "~",
      "advice": "~",
      "inquire": "So?",
      "success": "Yes!!!",
      "success_lie": "~",
      "failure": "~"
    }
  }
]
