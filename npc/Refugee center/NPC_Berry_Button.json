[
  {
  	"//":"TODO write normal text not this bullshit parody of a writing, add 2-3 missions; redo checks for dialogue by 'sentinel' effect in 'speaker_effect'",
    "type": "npc",
    "id": "Berry_Button",
    "name_unique": "Berry Button",
    "gender": "male",
    "name_suffix": "refugee",
	"class": "C_Berry_Button",
    "attitude": 0,
    "mission": 7,
    "chat": "TALK_REFUGEE_Berry_1",
    "faction": "free_merchants",
	"mission_offered": "MISSION_BerryButton_1"
  },
    {
    "type": "npc_class",
    "id": "C_Berry_Button",
    "name": { "str": "Berry Button" },
    "job_description": "I'm just trying to survive.",
    "common": false,
    "carry_override": "Barry_Button_carried"
  },
  {
    "type": "item_group",
    "id": "Barry_Button_carried",
    "subtype": "collection",
    "entries": [ { "item": "rock" } ]
  },
  {
    "id": ["TALK_REFUGEE_Berry_1"],
    "type": "talk_topic",
	"dynamic_line": "Hello there, pal.",
    "responses": [
	  { 
	  "text": "About that job...",
  	  "topic": "TALK_MISSION_INQUIRE",
      "condition":"has_assigned_mission"
	  },
      {  	"//":"TODO add check 'already have job'", 
	  "text": "Can I help you with something?", "topic": "TALK_MISSION_LIST"},
      { "text": "What's your story?", "topic": "TALK_Berry_Background" },
	  {
        "text": "You do realise that you payed me with worthless green paper, right?",
        "effect": { "npc_add_var": "u_angry_mis1_rew_Berry", "type": "general", "context": "meeting", "value": "yes" },
        "condition": {
			"and":[
				{"not": { "npc_has_var": "u_angry_mis1_rew_Berry", "type": "general", "context": "meeting", "value": "yes" }},
				{"npc_has_var": "MISSION_BerryButton_1", "type": "mission", "context": "flag", "value": "yes"}
			]
		},
        "topic": "TALK_REFUGEE_Berry_angry1"
      },
	  {"text": "Well, bye.", "topic": "TALK_DONE"},
	  {
	    "text":"So, what about that help?",
	    "topic":"BerryB_Help",
	    "condition":{"u_has_var": "MISSION_BerryButton_3_help", "type": "general", "context": "flag", "value": "yes"},
	    "effect": [
			{"u_buy_item": "two_way_radio", "count": 2},
			{"npc_change_faction": "your_followers"},
			{"u_lose_var": "MISSION_BerryButton_3_help", "type": "general", "context": "flag", "value": "yes"}
		]
	  },
	  {
	    "text":"You know, I tried that moonshine. It tastes like HELL!",
	    "topic":"BerryB_tried_ub_moonshine",
	    "condition":{"u_has_effect": "took_ub_mustang"}
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Berry_Background",
    "dynamic_line": "I'm just a guy. Nothing more, nothing else.",
    "responses": [
      { "text": "What were you saying before?", "topic": "TALK_NONE" },
      { "text": "I'd better get going.", "topic": "TALK_DONE" }
    ]
  },
    {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Berry_angry1",
    "dynamic_line": "Huh? What are you talking about? You do not recognise american dollars? For that money you can buy a lot more booze than you brought me!",
    "responses": [
      {
        "text": "If you didn't notice, old world is dead, and old curencies have little to none value now. Heck, I doubt I can found someone who will want to trade something with this paper.",
        "topic": "TALK_REFUGEE_Berry_angry2"
      }
    ]
  },
   {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Berry_angry2",
    "dynamic_line": "Oh, that's why that merchant guy give me a weird look when I offered , . Sorry, pal, I didnt think about that until now, heh. *he smiled* Next time, I'll give you something of worth. You have my word!",
    "responses": [
      {"text": "I hope so!", "topic": "TALK_DONE"},
	  {"text": "Hey, 'pal', maybe you want to compensate my time with something of worth?",
	    "trial": { "type": "PERSUADE", "difficulty": 5 },
		"success": { "topic": "TALK_BerryB_Agree" },
		"failure": { "topic": "TALK_BerryB_Disagree" }
	  }
    ]
  },
   {
   "//":"TODO change reward",
    "type": "talk_topic",
    "id": "TALK_BerryB_Agree",
    "dynamic_line": "Yeah, sure, pal.",
    "responses": [
      { "text": "That's more like it.","topic": "TALK_DONE",
	    "effect": {"u_buy_item": "rock", "count": 3}
	  }
    ]
  },
   {
    "type": "talk_topic",
    "id": "TALK_BerryB_Disagree",
    "dynamic_line": "No way, pal!",
    "responses": [
      {"text": "...", "topic": "TALK_DONE"}
    ]
  },
  {
    "type": "talk_topic",
    "id": "BerryB_Help",
    "dynamic_line": "Here's two two-way radios. Get them on one freuquency and give me one radio. Contact me trough it when you find my brother.",
    "responses": [
      { "text": "Ok. *You mess with the radios* Here you go. Wait for my signal.", "topic": "TALK_DONE",
	    "effect": [
			{"u_sell_item": "two_way_radio", "count": 1},
			{"npc_first_topic":"TALK_REFUGEE_Berry_2"}
		]
	  }
    ]
  },
  {
    "type": "talk_topic",
    "id": "BerryB_Brother",
    "dynamic_line": "*pshhhttt* Nice work! Ok, listen up: I w**nt*yo***o***********and th************be care*********stay far fro****************",
    "speaker_effect":[
		{"npc_change_faction": "free_merchants"},
		{"npc_first_topic":"TALK_REFUGEE_Berry_2"},
		{"npc_add_var": "BerryB_radio_fail", "type": "general", "context": "flag", "value": "yes"}
	],
    "responses": [
      { "text": "Damn, why does this thing don't work properly? Bah.", "topic": "TALK_DONE"}
    ]
  },
  {
    "id": ["TALK_REFUGEE_Berry_2"],
    "type": "talk_topic",
    "dynamic_line":"is_by_radio",
		"yes": "*pshhhttt* So, what about my brother?",
		"no": { "npc_has_var": "BerryB_radio_fail", "type": "general", "context": "flag", "value": "yes",
			"yes":"*pshhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh*",
			"no":"So, what about my brother?"
		},
    "replace_built_in_responses": true,
    "responses": [
	  { 
	    "text": "I got your brother.",
  	    "topic": "BerryB_Brother",
        "condition":{
	  	  "or":[
			{
			  "and":[
				  "is_by_radio",
				{ "u_has_var": "BarryB_met", "type": "general", "context": "meeting", "value": "yes"},
				{ "not":{"npc_has_var": "BerryB_radio_fail", "type": "general", "context": "flag", "value": "yes"} } 
			  ]
			},
			{
			  "and":[
				{ "u_has_var": "BarryB_met", "type": "general", "context": "meeting", "value": "yes"},
				{ "not":"is_by_radio"},
				{ "not":{ "npc_has_var": "BerryB_radio_fail", "type": "general", "context": "flag", "value": "yes" } }
			  ]
			}
		  ]
	    }
	  },
      { "text": "I'm still looking for him.", "topic": "TALK_DONE",
        "condition":{ "not":{ "u_has_var": "BarryB_met", "type": "general", "context": "meeting", "value": "yes" } }
	  },
      { "text": "...", "topic": "TALK_DONE",
        "condition":{
		  "and":[
			 "is_by_radio",
			{"npc_has_var": "BerryB_radio_fail", "type": "general", "context": "flag", "value": "yes"}
		  ]
	    }
	  }
	]
  },
  {
    "type": "talk_topic",
    "id": "BerryB_tried_ub_moonshine",
    "dynamic_line": "AHAHAHAHHAHAAAAHAHAHAHAHAHHAHAHAHAHAHAHAHAHAHHAHAHAH",
    "responses": [
      { "text": "...", "topic": "TALK_DONE",
	    "effect":[ { "u_lose_effect":"took_ub_mustang" } ]
	  }
    ]
  },
  {
    "id": "MISSION_BerryButton_1",
    "type": "mission_definition",
    "name": { "str": "Bring vodka" },
    "description": "Berry want some vodka for his soar throat. Bring him a bottle.",
    "goal": "MGOAL_FIND_ITEM",
    "difficulty": 0,
    "item": "rock",
    "count": 1,
    "value": 500,
	"end": {
      "effect": [
        { "u_buy_item": "money_bundle", "count": 1 },
        { "npc_add_var": "MISSION_BerryButton_1", "type": "mission", "context": "flag", "value": "yes" }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_BerryButton_2",
    "dialogue": {
      "describe": "Vodka!!",
      "offer": "Look, pal, I need to steep my throat, so bring me a bottle of vodka, please. I'll pay you.",
      "accepted": "Thank you, pal. I'll wait for you right here!",
      "rejected": "Well, thats bad. Return if you change your mind.",
      "advice": "Try to look in the bar or in some lonely guy's house.",
      "inquire": "Did you found any vodka?",
      "success": "Heh. I believed in you, pal. *Berry took a large sip* Here's the cash i promised. Spend it well, he-he.",
      "success_lie": "Hey, pal, you call this a vodka?!",
      "failure": "Pal..."
    }
  },
  {
    "id": "MISSION_BerryButton_2",
    "type": "mission_definition",
    "name": { "str": "Bring nice moonshine" },
    "description": "Berry asked you to bring him a bottle of nice moonshine called 'Uncle Ben's Mustang'.",
    "goal": "MGOAL_FIND_ITEM",
    "difficulty": 3,
    "item": "uncle_bens_mustang",
    "value": 1000,
		"//":"TODO add Uncle Ben",
    "start": {
      "assign_mission_target": 
	  { 
		"om_terrain": "moonshine_still",
		"om_special": "Moonshine Still",
		"om_terrain_replace": "forest",
		"reveal_radius": 1,
		"search_range": 50
	  },
        "update_mapgen": { 
	      "place_item": [ { "item": "uncle_bens_mustang", "x":  13 , "y": 12, "target":true } ],
	      "place_monster": [{ "monster": "mon_zombie_brute", "x": 13, "y": 12 }]  
	    }
	  },
	"end": {
      "effect": [
        { "u_buy_item": "FMCNote", "count": 30 }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_BerryButton_3",
    "dialogue": {
      "describe": "Uncle Ben's Mustang!!",
      "offer": "Hey, pal, glad you still alive. Listen, I have another job for you. Have you heard about 'Uncle Ben's Mustang'? It's the best moonshine in the entire state! Sadly, there is a high chance that Ol' Benny is dead by now... BUT! I got this nice map with all 'shady' places in the woods with different spots for moonshiners to meet. So, I want YOU to visit one of the places, and maybe grab me a few bottles if you find any... Hey, hey, don't go! I'll share! Fine, I'll even give you some nice looking trader banknots. So, whacha say?",
      "accepted": "I knew you wouldn't refuse such a deal, pal. I'll wait for you right here!",
      "rejected": "Well, thats bad. Return if you change your mind.",
      "advice": "Don't smoke in the woods!",
      "inquire": "Did you found it?",
      "success": "Heh. I believed in you, pal. *Berry took a large sip* Here's the cash i promised you. Spend it well, he-he.",
      "success_lie": "Hey, pal, don't try to fool me!",
      "failure": "Pal..."
	}
  },
  {
    "id": "MISSION_BerryButton_3",
    "type": "mission_definition",
    "name": { "str": "Find my brother" },
    "description": "Berry asked you to find his brother. According to him, his brother got caught by some bandits.",
    "goal": "MGOAL_CONDITION",
	"goal_condition": { "u_has_var": "BarryB_safe", "type": "general", "context": "meeting", "value": "yes" },
    "difficulty": 0,
    "value": 4000,
    "start": 
	{
	  "effect": [ { "u_add_var": "MISSION_BerryButton_3_help", "type": "general", "context": "flag", "value": "yes" } ],
      "assign_mission_target":{
        "om_terrain": "cabin",
        "om_special": "Cabin",
        "om_terrain_replace": "forest",
        "reveal_radius": 1,
        "min_distance": 10,
        "search_range": 100
	  },
		"update_mapgen": {
			"place_npcs": [ 
				{ "class": "Barry_Button", "x": 7, "y": 5 },
				{ "class": "bandit", "x": 6, "y": 14 },
				{ "class": "bandit", "x": 10, "y": 15 },
				{ "class": "bandit", "x": 13, "y": 15 },
				{ "class": "bandit", "x": 6, "y": 16 },
				{ "class": "bandit", "x": 10, "y": 16 },
				{ "class": "bandit", "x": 13, "y": 16 },
				{ "class": "bandit", "x": 11, "y": 21 },
				{ "class": "bandit", "x": 13, "y": 21 }
		    ]
		}
	},
	"end": {
      "effect": [
        {"u_buy_item": "FMCNote", "count": 56},
		{"u_lose_var": "MISSION_BerryButton_3_help", "type": "general", "context": "flag", "value": "yes"}	 
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_BerryButton_4",
    "dialogue": {
      "describe": "Brother!!",
      "offer": "Hey, pal, I've got an emergency here. You helped me before, so I put my trust in you on this! A few days ago, my brother went to forrest to find some help for a... lets say, some 'delicate' work. Problem is, the boys with whom he was supposed to make a deal, were nuts! You'll need my help.",
	  "accepted": "Thank you, pal. I owe you a big one! Talk to me if you need aditional help on this task.",
      "rejected": "Bruh.",
      "advice": "Don't!",
      "inquire": "Did you found him?",
      "success": "Heh. Nice",
      "success_lie": "Hey, pal, don't try to fool me!",
      "failure": "Pal..."
	}
  }
]